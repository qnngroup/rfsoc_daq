# Script README

Collection of scripts for automation of project generation and simulation.
For most use cases, just run the executable `.sh` scripts to do various tasks.

## sh scripts

### `setup_project.sh`
Generates a fresh project in `<repo-root>/build/proj_synth/` for synthesis and implementation.
Will delete any existing project under `<repo-root>/build/proj_synth/`, so make sure to save

### `bitstream.sh`
Generates a bitstream based on the synthesizable RTL in the project.
Optionally reruns project creation and setup if you want to make sure you're starting from a clean slate.
Deleting and regenerating the whole project can take some time to run out-of-context synthesis on the Vivado IPs used in the block diagram, so this is not generally advised.
However, a clean build should be run before creating a new release by running `./bitstream.sh 1`.

### `get_compilation_order.sh`
Called by `lint.sh` to generate a compilation order. TODO use a separate tree-sitter or static analyzer to automatically determine the hierarchy.

### `lint.sh`
Performs static code analysis with verilator to check for syntax errors, width mismatches, or bad coding practices.
If you get lint errors, make sure that your modules are correctly included in the hierarchy with `get_compilation_order.sh`

### `regression.sh`
Calls `run_unit_test` on all modules with a name that matches the regex `.*_test`.
Must be run before merging a commit to main.

### `unit.sh`
Execute `./unit.sh my_module_test` to run toplevel test module `my_module_test`.
Can optionally supply multiple unit tests to run `./unit.sh module_1_test [module_2_test ...]`

## tcl scripts

- `clean.tcl`: removes existing project from `<repo-root>/build/` (either `proj_synth` or `proj_sim` depending on the `project_type` tcl variable.
- `make_bd.tcl`: sets up a new `proj_synth` synthesis project and sources `top.tcl` to generate a block diagram. Creates a wrapper
- `make_bitstream.tcl`: launches `synth` and `impl` runs
- `make_project.tcl`: creates a new project and adds all sources to it
- `run_lint.tcl`: unusued in current workflow. Uses Vivado syntax checker
- `run_unit_test.tcl`: iterates over list of supplied test modules, setting each one as top and running a simulation. Tracks failing modules and reports total errors and the names of failing modules before exiting.
- `top.tcl`: Vivado autogenerated tcl for toplevel block design
- `verilator_config.vlt`: Configuration for verilator linter
- `null_moduels/xpm_cdc.sv`: Verilator requires all modules to be defined, however Vivado `xpm` IP aren't lint-clean, so just create a black-box dummy module so that Verilator doesn't complain.
